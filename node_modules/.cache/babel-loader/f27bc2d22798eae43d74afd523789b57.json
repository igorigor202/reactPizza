{"ast":null,"code":"import _objectSpread from\"C:/Users/Igor N/Desktop/react pizza 24 L/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"C:/Users/Igor N/Desktop/react pizza 24 L/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"C:/Users/Igor N/Desktop/react pizza 24 L/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Igor N/Desktop/react pizza 24 L/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React from'react';import Categories from'../components/Categories';import SortPopup,{sortList}from'../components/SortPopup';import LoadingBlock from'../components/PizzaBlock/Skeleton';import PizzaBlock from'../components/PizzaBlock';import Pagination from'../components/Pagination';import{useSelector}from'react-redux';import qs from'qs';import{useNavigate}from'react-router-dom';import{useAppDispatch}from'../redux/store';import{selectPizzaData}from'../redux/pizza/selectors';import{selectFilter}from'../redux/filter/selectors';import{setCategoryId,setCurrentPage,setFilters}from'../redux/filter/slice';import{fetchPizzas}from'../redux/pizza/asyncActions';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=function Home(){var _useSelector=useSelector(selectPizzaData),items=_useSelector.items,status=_useSelector.status;var _useSelector2=useSelector(selectFilter),categoryId=_useSelector2.categoryId,sort=_useSelector2.sort,currentPage=_useSelector2.currentPage,searchValue=_useSelector2.searchValue;var navigate=useNavigate();var dispatch=useAppDispatch();var isSearch=React.useRef(false);var isMounted=React.useRef(false);var onChangeCategory=React.useCallback(function(index){dispatch(setCategoryId(index));},[]);var onChangePage=function onChangePage(page){dispatch(setCurrentPage(page));};var getPizzas=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var order,sortBy,category,search;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:order=sort.sortProperty.includes('-')?'asc':'desc';sortBy=sort.sortProperty.replace('-','');category=categoryId>0?\"category=\".concat(categoryId):'';search=searchValue?\"&search=\".concat(searchValue):'';dispatch(//@ts-ignore\nfetchPizzas({order:order,sortBy:sortBy,category:category,search:search,currentPage:String(currentPage)}));case 5:case\"end\":return _context.stop();}}},_callee);}));return function getPizzas(){return _ref.apply(this,arguments);};}();React.useEffect(function(){if(isMounted.current){var queryString=qs.stringify({categoryId:categoryId,sortProperty:sort.sortProperty,currentPage:currentPage});navigate(\"?\".concat(queryString));}isMounted.current=true;},[categoryId,sort.sortProperty,currentPage]);React.useEffect(function(){if(window.location.search){var params=qs.parse(window.location.search.substring(1));var _sort=sortList.find(function(obj){return obj.sortProperty===params.sortBy;});dispatch(setFilters({searchValue:params.search,categoryId:Number(params.category),currentPage:Number(params.currentPage),sort:_sort||sortList[0]}));isSearch.current=true;}},[]);React.useEffect(function(){getPizzas();isSearch.current=false;},[categoryId,sort.sortProperty,searchValue,currentPage]);var skeletons=_toConsumableArray(new Array(6)).map(function(_,i){return/*#__PURE__*/_jsx(LoadingBlock,{},i);});var itemsPizzas=items.filter(function(obj){return obj.title.toLowerCase().includes(searchValue.toLowerCase());}).map(function(obj){return/*#__PURE__*/_jsx(PizzaBlock,_objectSpread({},obj),obj.id);});return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"content__top\",children:[/*#__PURE__*/_jsx(Categories,{value:categoryId,onChangeCategory:onChangeCategory}),/*#__PURE__*/_jsx(SortPopup,{value:sort})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"content__title\",children:\"\\u0412\\u0441\\u0435 \\u043F\\u0438\\u0446\\u0446\\u044B\"}),/*#__PURE__*/_jsx(\"div\",{className:\"content__items\",children:status==='loading'?skeletons:itemsPizzas}),/*#__PURE__*/_jsx(Pagination,{currentPage:currentPage,onChangePage:onChangePage})]});};export default Home;","map":{"version":3,"names":["React","Categories","SortPopup","sortList","LoadingBlock","PizzaBlock","Pagination","useSelector","qs","useNavigate","useAppDispatch","selectPizzaData","selectFilter","setCategoryId","setCurrentPage","setFilters","fetchPizzas","Home","items","status","categoryId","sort","currentPage","searchValue","navigate","dispatch","isSearch","useRef","isMounted","onChangeCategory","useCallback","index","onChangePage","page","getPizzas","order","sortProperty","includes","sortBy","replace","category","search","String","useEffect","current","queryString","stringify","window","location","params","parse","substring","find","obj","Number","skeletons","Array","map","_","i","itemsPizzas","filter","title","toLowerCase","id"],"sources":["C:/Users/Igor N/Desktop/react pizza 24 L/src/pages/Home.tsx"],"sourcesContent":["import React from 'react';\nimport Categories from '../components/Categories';\nimport SortPopup, { sortList } from '../components/SortPopup';\nimport LoadingBlock from '../components/PizzaBlock/Skeleton';\nimport PizzaBlock from '../components/PizzaBlock';\nimport Pagination from '../components/Pagination';\nimport { useSelector } from 'react-redux';\n\nimport qs from 'qs';\nimport { useNavigate } from 'react-router-dom';\nimport { useAppDispatch } from '../redux/store';\nimport { selectPizzaData } from '../redux/pizza/selectors';\nimport { selectFilter } from '../redux/filter/selectors';\nimport { setCategoryId, setCurrentPage, setFilters } from '../redux/filter/slice';\nimport { SearchPizzaParams } from '../redux/pizza/types';\nimport { fetchPizzas } from '../redux/pizza/asyncActions';\n\nconst Home: React.FC = () => {\n  const { items, status } = useSelector(selectPizzaData);\n  const { categoryId, sort, currentPage, searchValue } = useSelector(selectFilter);\n  const navigate = useNavigate();\n  const dispatch = useAppDispatch();\n  const isSearch = React.useRef(false);\n  const isMounted = React.useRef(false);\n\n  const onChangeCategory = React.useCallback((index: number) => {\n    dispatch(setCategoryId(index));\n  }, []);\n\n  const onChangePage = (page: number) => {\n    dispatch(setCurrentPage(page));\n  };\n\n  const getPizzas = async () => {\n    const order = sort.sortProperty.includes('-') ? 'asc' : 'desc';\n    const sortBy = sort.sortProperty.replace('-', '');\n    const category = categoryId > 0 ? `category=${categoryId}` : '';\n    const search = searchValue ? `&search=${searchValue}` : '';\n\n    dispatch(\n      //@ts-ignore\n      fetchPizzas({\n        order,\n        sortBy,\n        category,\n        search,\n        currentPage: String(currentPage),\n      }),\n    );\n  };\n  React.useEffect(() => {\n    if (isMounted.current) {\n      const queryString = qs.stringify({\n        categoryId,\n        sortProperty: sort.sortProperty,\n        currentPage,\n      });\n\n      navigate(`?${queryString}`);\n    }\n\n    isMounted.current = true;\n  }, [categoryId, sort.sortProperty, currentPage]);\n\n  React.useEffect(() => {\n    if (window.location.search) {\n      const params = qs.parse(window.location.search.substring(1)) as unknown as SearchPizzaParams;\n      const sort = sortList.find((obj) => obj.sortProperty === params.sortBy);\n\n      dispatch(\n        setFilters({\n          searchValue: params.search,\n          categoryId: Number(params.category),\n          currentPage: Number(params.currentPage),\n          sort: sort || sortList[0],\n        }),\n      );\n      isSearch.current = true;\n    }\n  }, []);\n\n  React.useEffect(() => {\n    getPizzas();\n\n    isSearch.current = false;\n  }, [categoryId, sort.sortProperty, searchValue, currentPage]);\n\n  const skeletons = [...new Array(6)].map((_, i) => <LoadingBlock key={i} />);\n  const itemsPizzas = items\n    .filter((obj: any) => {\n      return obj.title.toLowerCase().includes(searchValue.toLowerCase());\n    })\n    .map((obj: any) => <PizzaBlock key={obj.id} {...obj} />);\n\n  return (\n    <div className=\"container\">\n      <div className=\"content__top\">\n        <Categories value={categoryId} onChangeCategory={onChangeCategory} />\n        <SortPopup value={sort} />\n      </div>\n      <h2 className=\"content__title\">Все пиццы</h2>\n      <div className=\"content__items\">{status === 'loading' ? skeletons : itemsPizzas}</div>\n      <Pagination currentPage={currentPage} onChangePage={onChangePage} />\n    </div>\n  );\n};\n\nexport default Home;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}